def handle(self, handler_input):
        #handler_input.response_builder.add_directive(get_dynamic_entities_directive())
        session_attr = handler_input.attributes_manager.session_attributes
        intent_name = handler_input.request_envelope.request.intent.name
        if session_attr.get("contexto_atual") == "monitor_in_progress":
            session_attr["contexto_atual"] = "monitor_in_progress"
        else:
            session_attr["contexto_atual"] = "selecao_ativo"
        session_attr["select_in_progress"] = True
        log_info(f"Intent recebido: {intent_name}")

        intent = handler_input.request_envelope.request.intent
        slots = intent.slots
        fund_name = slots.get("fundName").value #if slots.get("fundName") else None
        log_intent_event(handler_input, f"ğŸ§  Slot raw: {slots['fundName'].value}")
        log_info(f"ğŸ™ï¸ fund_name captado: {repr(fund_name)}")
        log_intent_event(handler_input, f"SelectFundIntentHandler acionado. Slots recebidos: {slots}")



        # Encontrar fundo completo e ID
            fundo_key = sigla.lower()
            fundo_full = None
            fundo_state_id = None
            for state_id, nome in state_asset_mapping.items():
                if limpar_asset_name(nome) == sigla_normalizada:
                    fundo_full = nome
                    fundo_state_id = state_id
                    break




# Tentativa de reconhecimento por voz
        tentativas = session_attr.get("tentativas_fundo", 0)

        if not fund_name:
            session_attr["tentativas_fundo"] = tentativas + 1
            if tentativas < 2:
                speech = "Desculpe, nÃ£o entendi o nome do ativo. Tente falar: mostrar ativo segido do nome do ativo sem o nÃºmero?"
                return handler_input.response_builder.speak(speech).ask(speech).set_should_end_session(False).response
            else:
                session_attr["tentativas_fundo"] = 0
                session_attr["select_in_progress"] = True
                apl_doc = _load_apl_document("apl_select_ativo.json")
                handler_input.response_builder.add_directive(RenderDocumentDirective(
                    token="inputScreenToken", document=apl_doc))
                speech = "NÃ£o consegui entender. Por favor, digite o nome do fundo na tela."
                return handler_input.response_builder.speak(speech).set_should_end_session(False).response